import streamlit as st
import google.generativeai as genai
import pandas as pd
import base64
from io import BytesIO

# Configure API key
api_key = "AIzaSyAxz3eWwhOlP-g3Cws-O153RGnxoidGv_0"
genai.configure(api_key=api_key)

# Function to load Google Gemini Pro and get response
def get_gemini_response(prompt):
    model = genai.GenerativeModel('gemini-pro')
    response = model.generate_content([prompt])
    if not response or not response.parts:
        st.error("No valid response returned. The content might have been blocked.")
        return "No valid response returned. Please check the input requirements."
    return response.parts[0].text

# Streamlit UI
st.title("Generate Test Cases")

# Input for user requirements
requirement = st.text_area("Enter the requirements for generating test cases:")

# Generate test cases based on user input
if st.button("Generate Test Cases"):
    test_cases = get_gemini_response(requirement)

    # Display the generated test cases
    st.subheader("Generated Test Cases:")
    st.write(test_cases)

    # Convert to DataFrame with each test case in a separate row
    test_cases_list = [case.strip() for case in test_cases.split('\n') if case.strip()]
    df = pd.DataFrame({"Test Cases": test_cases_list})

    # Display the DataFrame
    st.subheader("Generated Test Cases (Formatted):")
    st.write(df)

    # Export DataFrame to Excel and provide download link
    excel_data = BytesIO()
    with pd.ExcelWriter(excel_data, engine='xlsxwriter') as writer:
        df.to_excel(writer, index=False, header=True)
    excel_data.seek(0)

    # Create a download link
    href = f'<a href="data:application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;base64,{base64.b64encode(excel_data.read()).decode()}"" download="generated_test_cases.xlsx">Download Excel File</a>'
    st.markdown(href, unsafe_allow_html=True)
